<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Different Table Access Approaches</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 50px auto; padding: 20px; }
        .test { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Testing Different Supabase Table Access Methods</h1>
    <div id="results"></div>

    <script>
        async function runTests() {
            const results = document.getElementById('results');
            const supabaseUrl = 'https://cqcgnlwvncblxfyztvtp.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNxY2dubHd2bmNibHhmeXp0dnRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5Mzk4NDgsImV4cCI6MjA2NzUxNTg0OH0.vBT_jVPj1u7V5BNaFFXiS_Z2JxpowWFGEtdQCt7o2WY';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            
            const tests = [
                {
                    name: 'Method 1: Direct table name with underscore',
                    query: () => supabase.from('acting_institute_contacts').select('*').limit(1)
                },
                {
                    name: 'Method 2: Schema.table notation',
                    query: () => supabase.from('acting_institute.contacts').select('*').limit(1)
                },
                {
                    name: 'Method 3: Using schema() method (if exists)',
                    query: () => {
                        if (supabase.schema) {
                            return supabase.schema('acting_institute').from('contacts').select('*').limit(1);
                        } else {
                            return Promise.resolve({ error: { message: 'schema() method not available' } });
                        }
                    }
                },
                {
                    name: 'Method 4: RPC function approach',
                    query: () => supabase.rpc('get_acting_institute_contacts', {})
                },
                {
                    name: 'Method 5: Check public schema tables',
                    query: () => supabase.from('contacts').select('*').limit(1)
                },
                {
                    name: 'Method 6: Raw SQL via RPC',
                    query: () => supabase.rpc('query_acting_institute', { 
                        query: 'SELECT * FROM acting_institute.contacts LIMIT 1' 
                    })
                }
            ];
            
            let html = '<h2>Test Results:</h2>';
            
            for (const test of tests) {
                html += `<div class="test">`;
                html += `<h3>${test.name}</h3>`;
                
                try {
                    const { data, error } = await test.query();
                    
                    if (error) {
                        html += `<div class="error">❌ Error: ${error.message}</div>`;
                        if (error.details) {
                            html += `<pre>${JSON.stringify(error, null, 2)}</pre>`;
                        }
                    } else {
                        html += `<div class="success">✅ Success! Found ${data?.length || 0} records</div>`;
                        if (data && data.length > 0) {
                            html += '<pre>' + JSON.stringify(data[0], null, 2) + '</pre>';
                        }
                    }
                } catch (e) {
                    html += `<div class="error">❌ Exception: ${e.message}</div>`;
                }
                
                html += '</div>';
            }
            
            // Also test what tables are visible
            html += '<div class="test"><h3>Checking available tables</h3>';
            try {
                // This might not work but worth trying
                const { data: tables, error: tablesError } = await supabase
                    .from('information_schema.tables')
                    .select('table_schema, table_name')
                    .in('table_schema', ['public', 'acting_institute'])
                    .order('table_schema, table_name');
                
                if (tablesError) {
                    html += `<div class="error">Could not query table list: ${tablesError.message}</div>`;
                } else if (tables) {
                    html += '<pre>' + JSON.stringify(tables, null, 2) + '</pre>';
                }
            } catch (e) {
                html += `<div class="error">Could not list tables: ${e.message}</div>`;
            }
            html += '</div>';
            
            results.innerHTML = html;
        }
        
        runTests();
    </script>
</body>
</html>